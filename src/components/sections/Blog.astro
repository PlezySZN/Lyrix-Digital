---
/**
 * ═══════════════════════════════════════════════════════════
 * BLOG SECTION — LYRIX OS
 * Astro wrapper → React island (hydrated on visible)
 * Fetches posts at build time, serializes to React props.
 * ═══════════════════════════════════════════════════════════
 */

import { getCollection } from 'astro:content';
import type { Lang } from '../../i18n/ui';
import BlogContent from '../BlogContent';
import type { BlogPostData } from '../BlogContent';

interface Props { lang: Lang; }
const { lang } = Astro.props;

const allPosts = await getCollection('blog', ({ data }) => {
  return data.lang === lang && !data.draft;
});

const posts: BlogPostData[] = allPosts
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3)
  .map((post) => ({
    slug: post.slug,
    title: post.data.title,
    description: post.data.description,
    tags: post.data.tags,
    date: post.data.date.toISOString(),
    wordCount: post.body ? post.body.split(/\s+/).length : 0,
  }));
---

<div class="cwv-defer">
  <BlogContent lang={lang} posts={posts} client:visible />
</div>
