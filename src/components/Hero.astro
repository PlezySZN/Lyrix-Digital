---
/**
 * ═══════════════════════════════════════════════════════════
 * HERO.ASTRO — LYRIX OS DESKTOP
 *
 * LCP-Optimized Hero Section.
 * - SSR-rendered <h1> for crawlers + screen readers
 * - Translations resolved at build time (not bundled in client JS)
 * - CSS containment on the hero to isolate layout/paint
 * - React island hydrates interactivity after first paint
 * ═══════════════════════════════════════════════════════════
 */

import type { Lang } from '../i18n/ui';
import { t } from '../i18n/utils';
import { pickTranslations, heroKeys, statusBarKeys } from '../i18n/translations';
import HeroContent from './HeroContent';
import StatusBar from './StatusBar';
import ContactModal from './ContactModal';
import ProjectModal from './ProjectModal';

interface Props { lang?: Lang; headline?: string; }
const { lang = 'en', headline } = Astro.props;

// Resolve translations at build time — not bundled in client JS
const heroT = pickTranslations(lang, [...heroKeys]);
const statusBarT = pickTranslations(lang, [...statusBarKeys]);

// If a custom headline is provided (e.g. city pages), use it.
// Otherwise fall back to the i18n default.
const resolvedHeadline = headline ?? t(lang, 'hero.headline');
---

{/*
  ═══ LCP FONT PRELOAD ═══
  Oswald 700 (hero headline) is the LCP text element.
  Preloading the exact weight eliminates FOIT and shaves
  ~200-400ms off LCP on cold loads.
*/}

<header
  class="relative"
  aria-label={lang === 'es' ? 'Sección principal' : 'Hero section'}
  style="contain: layout style paint;"
>
  <!--
    SSR-rendered h1 — crawlable by all bots (Googlebot, Bingbot, social scrapers).
    The React island renders a visual duplicate with scramble animation,
    marked aria-hidden to avoid double-announcement.
  -->

  <!--
    ═══ OPTIONAL: HERO BACKGROUND IMAGE ═══
    When you have a hero background, uncomment and import:

    import OptimizedImage from './OptimizedImage.astro';
    import heroBg from '../assets/hero-bg.jpg';

    <div class="absolute inset-0 -z-10 overflow-hidden">
      <OptimizedImage
        src={heroBg}
        alt=""
        priority
        class="w-full h-full object-cover"
        sizes="100vw"
      />
      <div class="absolute inset-0 bg-[#050505]/80" />
    </div>

    For art-directed crops (mobile vs desktop):
    import Picture from './Picture.astro';
    import heroMobile from '../assets/hero-mobile.jpg';
    import heroDesktop from '../assets/hero-desktop.jpg';

    <Picture
      mobile={{ src: heroMobile, width: 640, height: 960 }}
      desktop={{ src: heroDesktop, width: 1920, height: 1080 }}
      alt=""
      priority
      class="w-full h-full object-cover"
    />
  -->

  <!-- SSR <h1> — visible to crawlers & screen readers, visually hidden for sighted users
       (the React island renders an animated visual duplicate marked aria-hidden) -->
  <h1
    class="sr-only"
    set:html={resolvedHeadline}
  />
  <p class="sr-only">{t(lang, 'hero.subtitle')}</p>

  <!-- React Island: Hero with Finder Navigation -->
  <!-- Translations passed as props (resolved at build time) -->
  <HeroContent translations={heroT} client:load />
</header>

<!--
  StatusBar + Modals — MUST live outside any `contain:` context.
  `contain: layout|paint` creates a new containing block that traps
  `position: fixed` descendants. These need viewport-level positioning.
-->
<StatusBar translations={statusBarT} {lang} client:idle />
<ContactModal {lang} client:idle />
<ProjectModal {lang} client:idle />
