---
/**
 * ═══════════════════════════════════════════════════════════
 * HERO.ASTRO — LYRIX OS DESKTOP
 *
 * LCP-Optimized Hero Section.
 *
 * STRATEGY: The full hero is SSR-rendered as static HTML so the
 * headline (the LCP element) paints at FCP time — no JS required.
 * A React island then overlays on top to add interactivity
 * (hover color cycling, particle trail). The swap is seamless
 * because both render identical layouts.
 *
 * 1. SSR shell (id="hero-ssr") — normal flow, determines header height
 * 2. React island (id="hero-react") — absolute overlay, opacity 0→1
 * 3. On React mount: dispatch 'hero:ready' → fade in React, hide SSR
 * ═══════════════════════════════════════════════════════════
 */

import type { Lang } from '../i18n/ui';
import { t } from '../i18n/utils';
import { pickTranslations, heroKeys, statusBarKeys } from '../i18n/translations';
import HeroContent from './HeroContent';
import StatusBar from './StatusBar';
import ContactModal from './ContactModal';
import ProjectModal from './ProjectModal';

interface Props { lang?: Lang; headline?: string; }
const { lang = 'en', headline } = Astro.props;

// Resolve translations at build time — not bundled in client JS
const heroT = pickTranslations(lang, [...heroKeys]);
const statusBarT = pickTranslations(lang, [...statusBarKeys]);

// If a custom headline is provided (e.g. city pages), use it.
// Otherwise fall back to the i18n default.
const resolvedHeadline = headline ?? t(lang, 'hero.headline');
const subtitle = t(lang, 'hero.subtitle');
const finder = t(lang, 'hero.finder');
const ctaText = t(lang, 'hero.cta');
const ctaHint = t(lang, 'hero.cta.hint');
const ctaMeta = t(lang, 'hero.cta.meta');
---

<header
  class="relative"
  aria-label={lang === 'es' ? 'Sección principal' : 'Hero section'}
  style="contain: layout style paint;"
>
  <!-- SSR <h1> + <p> — crawlable by all bots, visually hidden -->
  <h1 class="sr-only" set:html={resolvedHeadline} />
  <p class="sr-only">{subtitle}</p>

  <!-- ═══════════════════════════════════════════════════════
       SSR LCP SHELL — Renders the FULL hero visually in static HTML.
       This is what the browser paints at FCP → becomes the LCP element.
       Normal flow — determines <header> height for the React overlay.
       ═══════════════════════════════════════════════════════ -->
  <div id="hero-ssr" aria-hidden="true">
    <div class="min-h-screen w-full bg-[#050505] p-4 pt-14 md:p-8 md:pt-8">
      <div class="relative w-full min-h-[calc(100vh-4rem)] rounded-xl border border-white/10 bg-[#0a0a0a] overflow-hidden">

        <!-- macOS Title Bar -->
        <div class="flex items-center gap-2 px-4 py-3 bg-[#27272a]/80 border-b border-white/5">
          <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#FF5F57]/50"></div>
            <div class="w-3 h-3 rounded-full bg-[#FEBC2E]/50"></div>
            <div class="w-3 h-3 rounded-full bg-[#28C840]/50"></div>
          </div>
          <div class="flex-1 text-center">
            <span class="text-xs font-medium text-white/60 tracking-wide">{finder}</span>
          </div>
          <div class="w-14"></div>
        </div>

        <!-- Grid Background -->
        <div
          class="absolute inset-0 pointer-events-none"
          style="background-image: linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px); background-size: 40px 40px;"
        ></div>

        <!-- Content: Headline left, CTA right -->
        <div class="relative z-10 flex flex-col lg:flex-row items-center lg:items-center justify-center lg:justify-between gap-10 lg:gap-16 min-h-[calc(100vh-8rem)] px-6 lg:px-16 xl:px-24 py-20">

          <!-- LEFT: Headline + Subtitle -->
          <div class="flex-1 flex flex-col items-center lg:items-start justify-center">
            <div class="hero-headline-container text-center lg:text-left mb-6 min-h-18 sm:min-h-21 md:min-h-27.5 lg:min-h-auto flex items-center justify-center lg:justify-start">
              <div
                class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-bold tracking-tight text-white leading-[1.1]"
                style="font-family: var(--font-oswald, sans-serif);"
              >
                {resolvedHeadline}
              </div>
            </div>
            <p class="text-center lg:text-left text-sm sm:text-base md:text-lg text-white/50 max-w-xl leading-relaxed px-4 lg:px-0">
              {subtitle}
            </p>
          </div>

          <!-- RIGHT: CTA Folder Card -->
          <div class="shrink-0 flex items-center justify-center">
            <div class="relative">
              <div class="relative w-80 sm:w-96 lg:w-[26rem] xl:w-[28rem] rounded-2xl border border-white/10 bg-white/3 overflow-hidden">
                <!-- Folder tab -->
                <div class="flex items-center gap-3 px-6 pt-5 pb-3">
                  <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-[#CCFF00]/10 border border-[#CCFF00]/20">
                    <svg class="w-6 h-6 text-[#CCFF00]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></svg>
                  </div>
                  <div class="flex-1 text-left">
                    <span class="text-sm font-mono text-[#CCFF00]/60 uppercase tracking-widest">Lyrix Digital</span>
                  </div>
                  <div class="w-2.5 h-2.5 rounded-full bg-[#CCFF00] animate-pulse-perf"></div>
                </div>
                <!-- Divider -->
                <div class="mx-6 border-t border-white/5"></div>
                <!-- CTA label -->
                <div class="px-6 py-6">
                  <div class="flex items-center justify-between gap-4">
                    <span class="flex-1 font-mono text-lg md:text-xl lg:text-2xl font-bold text-white tracking-wide">{ctaText}</span>
                    <svg class="w-6 h-6 shrink-0 text-white/40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                  </div>
                  <p class="text-sm text-white/30 font-mono mt-3">{ctaHint}</p>
                </div>
                <!-- Footer bar -->
                <div class="flex items-center justify-between px-6 py-4 bg-white/2 border-t border-white/5">
                  <span class="text-xs text-white/25 font-mono">{ctaMeta}</span>
                  <span class="text-xs text-white/25 font-mono">Type: Project</span>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════════════════════
       REACT ISLAND — Absolute overlay. Starts invisible.
       When React mounts it dispatches 'hero:ready', the inline
       script fades it in and hides the SSR shell underneath.
       ═══════════════════════════════════════════════════════ -->
  <div id="hero-react" class="absolute inset-0 z-20" style="opacity:0; transition: opacity 150ms ease-out;">
    <HeroContent translations={heroT} client:idle />
  </div>
</header>

<!-- Swap script — runs immediately, tiny, no bundle cost -->
<script is:inline>
  document.addEventListener('hero:ready', function h() {
    var s = document.getElementById('hero-ssr');
    var r = document.getElementById('hero-react');
    if (r) r.style.opacity = '1';
    if (s) s.style.visibility = 'hidden';
    document.removeEventListener('hero:ready', h);
  });
</script>

<!--
  StatusBar + Modals — MUST live outside any `contain:` context.
  `contain: layout|paint` creates a new containing block that traps
  `position: fixed` descendants. These need viewport-level positioning.
-->
<StatusBar translations={statusBarT} {lang} client:idle />
<ContactModal {lang} client:idle />
<ProjectModal {lang} client:idle />
